<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Drug Dose Calculator</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    .box { border: 1px solid #ccc; padding: 15px; margin-top: 15px; border-radius: 8px; }
    .warn { color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>โปรแกรมคำนวณขนาดยาวัณโรค</h1>

<label>อายุ (ปี): </label>
<input type="number" id="age" value="30"><br><br>

<label>น้ำหนัก (kg): </label>
<input type="number" id="weight" value="30"><br><br>

<button onclick="calculate()">คำนวณ</button>

<div id="result"></div>

<script>
function roundHalfTablet(mg, tablet) {
    return Math.ceil(mg / (tablet / 2)) * (tablet / 2);
}

function calculate() {
    const age = Number(document.getElementById("age").value);
    const wt = Number(document.getElementById("weight").value);
    let html = "";

    /* ================= IRZE / 2FDC ================= */
    html += `<div class="box"><h2>วัณโรคระยะแรก (IRZE / 2FDC)</h2>`;

    const drugs = [
        { name: "Isoniazid (H)", min: 5, max: 10, tab: 300 },
        { name: "Rifampicin (R)", min: 10, max: 20, tab: 300 },
        { name: "Pyrazinamide (Z)", min: 20, max: 30, tab: 500 },
        { name: "Ethambutol (E)", min: 15, max: 20, tab: 400 }
    ];

    drugs.forEach(d => {
        const minDose = d.min * wt;
        const maxDose = d.max * wt;
        let recDose = roundHalfTablet(minDose, d.tab);

        if (recDose < minDose) recDose += d.tab / 2;

        html += `
        <b>${d.name}</b><br>
        ขนาดที่คำนวณได้: ${Math.round(minDose)} – ${Math.round(maxDose)} mg/day<br>
        ขนาดยาที่แนะนำ: ${recDose} mg (${recDose / d.tab} เม็ด)<br><br>
        `;
    });

    html += `</div>`;

    /* ================= Latent TB : 3HP ================= */
    html += `<div class="box"><h2>วัณโรคแฝง (3HP)</h2>
    <p>1 เม็ด = Isoniazid 300 mg + Rifapentine 300 mg</p>`;

    let inhCalc = 0;
    let rptCalc = 0;
    let note = "";

    if (age >= 2 && age <= 14) {
        if (wt <= 15) { inhCalc = 300; rptCalc = 300; }
        else if (wt <= 23) { inhCalc = 500; rptCalc = 450; }
        else if (wt <= 30) { inhCalc = 600; rptCalc = 600; }
        else { inhCalc = 700; rptCalc = 750; }
    } else {
        inhCalc = Math.ceil((15 * wt) / 100) * 100;
        if (inhCalc > 900) inhCalc = 900;
        rptCalc = wt <= 50 ? 750 : 900;
    }

    let tabletsByINH = Math.ceil(inhCalc / 300);
    let tabletsByRPT = Math.ceil(rptCalc / 300);
    let tablets = Math.max(tabletsByINH, tabletsByRPT);

    let inhFinal = tablets * 300;
    let rptFinal = tablets * 300;

    if (inhFinal > inhCalc || rptFinal > rptCalc) {
        note = `<div class="warn">⚠️ โปรดใช้ดุลยพินิจในการตัดสินใจ</div>`;
    }

    html += `
    <b>ขนาดยาที่คำนวณได้</b><br>
    • INH ${inhCalc} mg<br>
    • Rifapentine ${rptCalc} mg<br><br>

    <b>ขนาดยาที่แนะนำ</b><br>
    • ${tablets} เม็ด / สัปดาห์<br>
    (INH ${inhFinal} mg + Rifapentine ${rptFinal} mg)
    ${note}
    </div>`;

    document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>

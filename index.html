<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Dose Calculator</title>
<style>
body { font-family: Arial, sans-serif; margin: 30px; }
h2 { margin-top: 30px; }
.box { border: 1px solid #ccc; padding: 15px; margin-top: 15px; }
.warn { color: red; font-weight: bold; }
</style>
</head>

<body>

<h1>โปรแกรมคำนวณขนาดยาวัณโรค</h1>

อายุ (ปี):
<input type="number" id="age">
น้ำหนัก (kg):
<input type="number" id="weight">
<button onclick="calculate()">คำนวณ</button>

<div id="output"></div>

<script>
function roundHalf(x) {
  return Math.round(x * 2) / 2;
}

function calculate() {
  const age = parseFloat(document.getElementById("age").value);
  const wt = parseFloat(document.getElementById("weight").value);
  if (!age || !wt) return alert("กรุณากรอกอายุและน้ำหนัก");

  let out = "";

  /* =========================
     1) แยกเม็ด I R Z E
     ========================= */
  const I = roundHalf((wt * 5) / 300);
  const R = roundHalf((wt * 10) / 300);
  const Z = roundHalf((wt * 25) / 500);
  const E = roundHalf((wt * 17.5) / 500);

  out += `
  <div class="box">
  <h2>1) แยกเม็ดยา I / R / Z / E</h2>
  Isoniazid 300 mg: ${I} เม็ด/วัน<br>
  Rifampicin 300 mg: ${R} เม็ด/วัน<br>
  Pyrazinamide 500 mg: ${Z} เม็ด/วัน<br>
  Ethambutol 500 mg: ${E} เม็ด/วัน
  </div>
  `;

  /* =========================
     2) 2FDC (H75 + R150)
     ========================= */
  const R_need = wt * 10;
  const tab2 = roundHalf(R_need / 150);

  out += `
  <div class="box">
  <h2>2) 2FDC (H75 + R150)</h2>
  ขนาดยาต่อเม็ด: H 75 mg + R 150 mg<br>
  จำนวนที่แนะนำ: ${tab2} เม็ด/วัน
  </div>
  `;

  /* =========================
     3) 4FDC (H75 + R150 + Z400 + E275)
     ========================= */
  const tab4 = roundHalf(wt / 15);

  out += `
  <div class="box">
  <h2>3) 4FDC (H75 + R150 + Z400 + E275)</h2>
  ขนาดยาต่อเม็ด: H 75 mg + R 150 mg + Z 400 mg + E 275 mg<br>
  จำนวนที่แนะนำ: ${tab4} เม็ด/วัน
  </div>
  `;

  /* =========================
     4) 3HP (LTBI)
     ========================= */
  let inh = 0, rpt = 0, note = "";

  if (age <= 14) {
    if (wt <= 15) { inh = 300; rpt = 300; }
    else if (wt <= 23) { inh = 500; rpt = 450; }
    else if (wt <= 30) { inh = 600; rpt = 600; }
    else { inh = 700; rpt = 750; }
  } else {
    inh = Math.min(Math.ceil((wt * 15) / 100) * 100, 900);
    rpt = wt <= 50 ? 750 : 900;
  }

  let tab3hp = roundHalf(Math.max(inh, rpt) / 300);

  if (tab3hp * 300 > inh || tab3hp * 300 > rpt) {
    note = "<div class='warn'>⚠ โปรดใช้ดุลยพินิจในการตัดสินใจ (ขนาดยาอาจเกินคำแนะนำ)</div>";
  }

  out += `
  <div class="box">
  <h2>4) วัณโรคแฝง (3HP)</h2>
  1 เม็ด = INH 300 mg + Rifapentine 300 mg<br><br>
  ขนาดยาที่คำนวณได้:<br>
  • INH ${inh} mg<br>
  • Rifapentine ${rpt} mg<br><br>
  ขนาดยาที่แนะนำ:<br>
  • ${tab3hp} เม็ด/สัปดาห์
  ${note}
  </div>
  `;

  document.getElementById("output").innerHTML = out;
}
</script>

</body>
</html>

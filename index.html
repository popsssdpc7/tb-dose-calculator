<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Dose Calculator</title>
<style>
body { font-family: Arial, sans-serif; margin: 30px; }
h2 { margin-top: 30px; }
.box { border: 1px solid #ccc; padding: 15px; margin-top: 15px; }
.warn { color: red; font-weight: bold; margin-top: 10px; }
.footer-warn {
  margin-top: 40px;
  padding-top: 15px;
  border-top: 2px solid #ccc;
  color: #b00000;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>โปรแกรมคำนวณขนาดยาวัณโรค</h1>

อายุ (ปี):
<input type="number" id="age">
น้ำหนัก (kg):
<input type="number" id="weight">
<button onclick="calculate()">คำนวณ</button>

<div id="output"></div>

<div class="footer-warn">
⚠ โปรแกรมอาจคำนวณผิดพลาดได้ โปรดตรวจสอบก่อนนำข้อมูลไปใช้<br>
ไม่ทดแทนดุลยพินิจแพทย์
</div>

<script>
function roundHalf(x) {
  return Math.round(x * 2) / 2;
}

function calculate() {
  const age = parseFloat(document.getElementById("age").value);
  const wt = parseFloat(document.getElementById("weight").value);
  if (!age || !wt) return alert("กรุณากรอกอายุและน้ำหนัก");

  let out = "";

  /* =========================
     1) แยกเม็ดยา I R Z E
     ========================= */

  // Isoniazid
  const I_min = wt * 4;
  const I_max = wt * 6;
  const I_tab = roundHalf((wt * 5) / 300);

  // Rifampicin
  const R_min = wt * 8;
  const R_max = wt * 12;
  const R_tab = roundHalf((wt * 10) / 300);

  // Pyrazinamide
  const Z_min = wt * 20;
  const Z_max = Math.min(wt * 30, 2000);
  const Z_tab = roundHalf((wt * 25) / 500);

  // Ethambutol
  const E_min = wt * 15;
  const E_max = Math.min(wt * 20, 1200);
  const E_tab = roundHalf((wt * 17.5) / 500);

  out += `
  <div class="box">
  <h2>1) แยกเม็ดยา I / R / Z / E</h2>

  <b>Isoniazid (H) 4–6 mg/kg/day</b><br>
  ${I_min.toFixed(0)} – ${I_max.toFixed(0)} mg/day<br>
  • ขนาดยาที่แนะนำ: ${I_tab} เม็ด (300 mg)<br><br>

  <b>Rifampicin (R) 8–12 mg/kg/day</b><br>
  ${R_min.toFixed(0)} – ${R_max.toFixed(0)} mg/day<br>
  • ขนาดยาที่แนะนำ: ${R_tab} เม็ด (300 mg)<br><br>

  <b>Pyrazinamide (Z) 20–30 mg/kg/day</b><br>
  ${Z_min.toFixed(0)} – ${Z_max.toFixed(0)} mg/day (max 2,000 mg)<br>
  • ขนาดยาที่แนะนำ: ${Z_tab} เม็ด (500 mg)<br><br>

  <b>Ethambutol (E) 15–20 mg/kg/day</b><br>
  ${E_min.toFixed(0)} – ${E_max.toFixed(0)} mg/day (max 1,200 mg)<br>
  • ขนาดยาที่แนะนำ: ${E_tab} เม็ด (500 mg)
  </div>
  `;

  /* =========================
     2) 2FDC
     ========================= */
  const tab2 = roundHalf((wt * 10) / 150);

  out += `
  <div class="box">
  <h2>2) 2FDC (H75 + R150)</h2>
  ขนาดยาต่อเม็ด: H 75 mg + R 150 mg<br>
  จำนวนที่แนะนำ: ${tab2} เม็ด/วัน
  </div>
  `;

  /* =========================
     3) 4FDC
     ========================= */
  const tab4 = roundHalf(wt / 15);

  out += `
  <div class="box">
  <h2>3) 4FDC (H75 + R150 + Z400 + E275)</h2>
  ขนาดยาต่อเม็ด: H 75 mg + R 150 mg + Z 400 mg + E 275 mg<br>
  จำนวนที่แนะนำ: ${tab4} เม็ด/วัน
  </div>
  `;

  /* =========================
     4) 3HP (LTBI)
     ========================= */
  let inh = 0, rpt = 0, note = "";

  if (age <= 14) {
    if (wt <= 15) { inh = 300; rpt = 300; }
    else if (wt <= 23) { inh = 500; rpt = 450; }
    else if (wt <= 30) { inh = 600; rpt = 600; }
    else { inh = 700; rpt = 750; }
  } else {
    inh = Math.min(Math.ceil((wt * 15) / 100) * 100, 900);
    rpt = wt <= 50 ? 750 : 900;
  }

  const tab3hp = roundHalf(Math.max(inh, rpt) / 300);

  if (tab3hp * 300 > inh || tab3hp * 300 > rpt) {
    note = "<div class='warn'>⚠ โปรดใช้ดุลยพินิจในการตัดสินใจ</div>";
  }

  out += `
  <div class="box">
  <h2>4) วัณโรคแฝง (3HP)</h2>
  1 เม็ด = INH 300 mg + Rifapentine 300 mg<br><br>
  ขนาดยาที่คำนวณได้:<br>
  • INH ${inh} mg<br>
  • Rifapentine ${rpt} mg<br><br>
  ขนาดยาที่แนะนำ:<br>
  • ${tab3hp} เม็ด/สัปดาห์
  ${note}
  </div>
  `;

  document.getElementById("output").innerHTML = out;
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Dose Calculator</title>
<style>
body { font-family: Arial, sans-serif; margin: 30px; }
.box { border: 1px solid #ccc; padding: 15px; margin-top: 20px; }
.warn { color: red; font-weight: bold; }
.footer { margin-top: 40px; border-top: 2px solid #ccc; padding-top: 10px; color: #b00000; }
h2 { margin-top: 0; }
</style>
</head>

<body>

<h1>โปรแกรมคำนวณขนาดยาวัณโรค</h1>

อายุ (ปี):
<input type="number" id="age">
น้ำหนัก (kg):
<input type="number" id="weight">
<button onclick="calculate()">คำนวณ</button>

<div id="output"></div>

<div class="footer">
⚠ โปรแกรมอาจคำนวณผิดพลาดได้ โปรดตรวจสอบก่อนนำข้อมูลไปใช้<br>
ไม่ทดแทนดุลยพินิจแพทย์
</div>

<script>
// ===============================
// เลือกจำนวนเม็ด (เต็มเม็ดก่อน)
// ===============================
function recommendTablet(minMg, maxMg, tabMg) {

  // เต็มเม็ด
  for (let t = 1; t <= 10; t++) {
    const dose = t * tabMg;
    if (dose >= minMg && dose <= maxMg) {
      return `แนะนำ: ${t} เม็ด (${dose} mg)`;
    }
  }

  // ครึ่งเม็ด
  for (let t = 0.5; t <= 10; t += 0.5) {
    if (Number.isInteger(t)) continue;
    const dose = t * tabMg;
    if (dose >= minMg && dose <= maxMg) {
      return `แนะนำ: ${t} เม็ด (${dose} mg)`;
    }
  }

  return `<span class="warn">ไม่สามารถคำนวณจำนวนเม็ดที่เหมาะสมได้</span>`;
}

// ===============================
// MAIN
// ===============================
function calculate() {
  const age = +document.getElementById("age").value;
  const wt = +document.getElementById("weight").value;
  if (!age || !wt) return alert("กรุณากรอกอายุและน้ำหนัก");

  let o = "";

  /* =========================
     1) แยกเม็ดยา I / R / Z / E
     ========================= */

  // Isoniazid (100 mg)
  const Imin = wt * 4;
  const Imax = wt * 6;
  const Irec = recommendTablet(Imin, Imax, 100);

  // Rifampicin
  const Rmin = wt * 8;
  const Rmax = wt * 12;
  const R300 = recommendTablet(Rmin, Rmax, 300);
  const R450 = recommendTablet(Rmin, Rmax, 450);

  // Pyrazinamide (500 mg)
  const Zmin = wt * 20;
  const Zmax = Math.min(wt * 30, 2000);
  const Zrec = recommendTablet(Zmin, Zmax, 500);

  // Ethambutol
  const Emin = wt * 15;
  const Emax = Math.min(wt * 20, 1200);
  const E400 = recommendTablet(Emin, Emax, 400);
  const E500 = recommendTablet(Emin, Emax, 500);

  o += `
  <div class="box">
  <h2>1) แยกเม็ดยา I / R / Z / E</h2>

  <b>Isoniazid (H) 4–6 mg/kg/day</b><br>
  ${Imin.toFixed(0)} – ${Imax.toFixed(0)} mg/day<br>
  เม็ดละ 100 mg → ${Irec}<br><br>

  <b>Rifampicin (R) 8–12 mg/kg/day</b><br>
  ${Rmin.toFixed(0)} – ${Rmax.toFixed(0)} mg/day<br>
  • เม็ดละ 300 mg → ${R300}<br>
  • เม็ดละ 450 mg → ${R450}<br><br>

  <b>Pyrazinamide (Z) 20–30 mg/kg/day</b><br>
  ${Zmin.toFixed(0)} – ${Zmax.toFixed(0)} mg/day (max 2,000 mg)<br>
  เม็ดละ 500 mg → ${Zrec}<br><br>

  <b>Ethambutol (E) 15–20 mg/kg/day</b><br>
  ${Emin.toFixed(0)} – ${Emax.toFixed(0)} mg/day (max 1,200 mg)<br>
  • เม็ดละ 400 mg → ${E400}<br>
  • เม็ดละ 500 mg → ${E500}
  </div>
  `;

  /* =========================
     2) 2FDC
     ========================= */
  const FDC2 = recommendTablet(Rmin, Rmax, 150);

  o += `
  <div class="box">
  <h2>2) 2FDC</h2>
  1 เม็ด = Isoniazid 75 mg + Rifampicin 150 mg<br>
  คำนวณตาม R → ${FDC2}
  </div>
  `;

  /* =========================
     3) 4FDC
     ========================= */
  const FDC4 = recommendTablet(Zmin, Zmax, 400);

  o += `
  <div class="box">
  <h2>3) 4FDC</h2>
  1 เม็ด = H75 + R150 + Z400 + E275 mg<br>
  คำนวณตาม Z → ${FDC4}
  </div>
  `;

  /* =========================
     4) วัณโรคแฝง (3HP)
     ========================= */
  let inh = 0, rpt = 0;

  if (age <= 14) {
    if (wt <= 15) { inh = 300; rpt = 300; }
    else if (wt <= 23) { inh = 500; rpt = 450; }
    else if (wt <= 30) { inh = 600; rpt = 600; }
    else { inh = 700; rpt = 750; }
  } else {
    inh = Math.min(Math.ceil((wt * 15) / 100) * 100, 900);
    rpt = wt <= 50 ? 750 : 900;
  }

  const HPmin = Math.max(inh, rpt);
  const HPrec = recommendTablet(HPmin, HPmin, 300);

  o += `
  <div class="box">
  <h2>4) วัณโรคแฝง (3HP)</h2>
  1 เม็ด = INH 300 mg + Rifapentine 300 mg<br><br>
  ขนาดยาที่คำนวณได้:<br>
  • INH ${inh} mg<br>
  • Rifapentine ${rpt} mg<br><br>
  ${HPrec}<br>
  <small>(รับประทานสัปดาห์ละครั้ง)</small>
  </div>
  `;

  document.getElementById("output").innerHTML = o;
}
</script>

</body>
</html>

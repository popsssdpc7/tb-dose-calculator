<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Drug Dose Calculator</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    padding: 30px;
}
.container {
    max-width: 650px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
h2 { text-align: center; }
label { font-weight: bold; }
input {
    width: 100%;
    padding: 8px;
    margin: 10px 0 20px;
    font-size: 16px;
}
button {
    width: 100%;
    padding: 12px;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
}
button:hover { background: #125aa0; }
.result {
    margin-top: 25px;
    padding: 15px;
    border-radius: 8px;
    background: #eef3f8;
}
.drug {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px dashed #bbb;
}
.alert { color: red; font-weight: bold; }
small { color: #555; }
</style>
</head>

<body>

<div class="container">
<h2>คำนวณขนาดยาวัณโรค</h2>

<label>น้ำหนักตัว (kg)</label>
<input type="number" id="weight" placeholder="เช่น 60" min="1">

<button onclick="calculateDose()">คำนวณขนาดยา</button>

<div id="result" class="result" style="display:none;"></div>
</div>

<script>
// คำนวณช่วงขนาดยา
function calculateDrug(weight, minMgKg, maxMgKg, maxDose) {
    const minDose = weight * minMgKg;
    const maxDoseCalc = weight * maxMgKg;
    const finalMax = Math.min(maxDoseCalc, maxDose);

    return {
        min: Math.round(minDose),
        max: Math.round(finalMax),
        exceeded: maxDoseCalc > maxDose
    };
}

// เลือกจำนวนเม็ดที่อยู่ในช่วง dose และใกล้ค่ากลางที่สุด
function calculateTabletsInRange(minDose, maxDose, strength, absoluteMax) {
    let bestTablets = 0;
    let bestDiff = Infinity;
    let target = (minDose + maxDose) / 2;

    for (let tablets = 1; tablets <= 10; tablets++) {
        let dose = tablets * strength;

        if (dose < minDose) continue;
        if (dose > maxDose) continue;
        if (dose > absoluteMax) continue;

        let diff = Math.abs(dose - target);
        if (diff < bestDiff) {
            bestDiff = diff;
            bestTablets = tablets;
        }
    }
    return bestTablets;
}

function calculateDose() {
    const weight = document.getElementById("weight").value;
    if (!weight || weight <= 0) {
        alert("กรุณาระบุน้ำหนักให้ถูกต้อง");
        return;
    }

    // Drug definitions
    const H = calculateDrug(weight, 4, 6, 300);
    const R = calculateDrug(weight, 8, 12, 600);
    const Z = calculateDrug(weight, 20, 30, 2000);
    const E = calculateDrug(weight, 15, 20, 1200);

    // Tablet calculation (อยู่ในช่วง dose)
    const H_tab = calculateTabletsInRange(H.min, H.max, 100, 300);
    const R_tab = calculateTabletsInRange(R.min, R.max, 300, 600);
    const Z_tab = calculateTabletsInRange(Z.min, Z.max, 500, 2000);
    const E_tab = calculateTabletsInRange(E.min, E.max, 500, 1200);

    const result = document.getElementById("result");
    result.style.display = "block";

    result.innerHTML = `
    <div class="drug">
        <b>Isoniazid (H)</b><br>
        ${H.min} – ${H.max} mg/day<br>
        • ขนาดยาที่แนะนำ: ${H_tab} เม็ด (100 mg/tab)
        ${H.exceeded ? '<br><span class="alert">⚠ max dose 300 mg</span>' : ''}
    </div>

    <div class="drug">
        <b>Rifampicin (R)</b><br>
        ${R.min} – ${R.max} mg/day<br>
        • ขนาดยาที่แนะนำ: ${R_tab} เม็ด (300 mg/tab)
        ${R.exceeded ? '<br><span class="alert">⚠ max dose 600 mg</span>' : ''}
    </div>

    <div class="drug">
        <b>Pyrazinamide (Z)</b><br>
        ${Z.min} – ${Z.max} mg/day<br>
        • ขนาดยาที่แนะนำ: ${Z_tab} เม็ด (500 mg/tab)
        ${Z.exceeded ? '<br><span class="alert">⚠ max dose 2000 mg</span>' : ''}
    </div>

    <div class="drug">
        <b>Ethambutol (E)</b><br>
        ${E.min} – ${E.max} mg/day<br>
        • ขนาดยาที่แนะนำ: ${E_tab} เม็ด (500 mg/tab)
        ${E.exceeded ? '<br><span class="alert">⚠ max dose 1200 mg</span>' : ''}
    </div>

    <small>
    ⚠️ เครื่องมือนี้ใช้เพื่อช่วยคำนวณขนาดยาเท่านั้น  
    ไม่ทดแทนดุลยพินิจแพทย์
    </small>
    `;
}
</script>

</body>
</html>

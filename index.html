<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Dose Calculator</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f6f9; padding:20px; }
.container { max-width:720px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
.drug { margin-bottom:18px; padding-bottom:12px; border-bottom:1px dashed #bbb; }
.note { font-size:0.9em; color:#555; }
.warn { margin-top:25px; color:darkred; font-weight:bold; }
</style>
</head>

<body>
<div class="container">
<h2>คำนวณขนาดยาวัณโรค (ยาแยกเม็ด)</h2>

น้ำหนัก (kg):
<input type="number" id="weight">
<button onclick="calculate()">คำนวณ</button>

<div id="result"></div>
</div>

<script>
function drugBlock(name, w, minMgKg, maxMgKg, strengths) {
  const minDose = w * minMgKg;
  const maxDose = w * maxMgKg;

  let html = `<div class="drug">
  <b>${name}</b> ${minMgKg}–${maxMgKg} mg/kg/day<br>
  <b>ขนาดยาที่คำนวณได้:</b> ${minDose.toFixed(0)} – ${maxDose.toFixed(0)} mg/day<br>
  <b>คำแนะนำ:</b><br>`;

  strengths.forEach(s => {
    const minTabs = Math.ceil(minDose / s);
    const maxTabs = Math.floor(maxDose / s);

    if (minTabs <= maxTabs) {
      html += `• ${minTabs} – ${maxTabs} เม็ด (${s} mg/เม็ด)<br>`;
    } else {
      const halfTabs = Math.round((minDose / s) * 2) / 2;
      const actual = halfTabs * s;

      if (actual >= minDose && actual <= maxDose) {
        html += `• ไม่มีเม็ดเต็มที่ลงตัว → อาจพิจารณา ${halfTabs} เม็ด (${s} mg/เม็ด)<br>`;
      } else {
        html += `• ไม่สามารถจัดขนาดยาให้เหมาะสมด้วยความแรง ${s} mg<br>`;
      }
    }
  });

  html += `<span class="note">แนะนำให้ใช้เม็ดเต็มก่อน หากอยู่ในช่วงการรักษา</span>
  </div>`;

  return html;
}

function calculate() {
  const w = parseFloat(document.getElementById("weight").value);
  if (!w || w <= 0) {
    alert("กรุณากรอกน้ำหนักให้ถูกต้อง");
    return;
  }

  let html = "";

  html += drugBlock("Isoniazid (I)", w, 4, 6, [100]);
  html += drugBlock("Rifampicin (R)", w, 8, 12, [300, 450]);
  html += drugBlock("Pyrazinamide (Z)", w, 20, 30, [500]);
  html += drugBlock("Ethambutol (E)", w, 15, 20, [400, 500]);

  html += `<div class="warn">
  ⚠ โปรแกรมอาจคำนวณผิดพลาดได้ กรุณาตรวจสอบก่อนนำไปใช้  
  ไม่สามารถใช้ทดแทนดุลยพินิจแพทย์
  </div>`;

  document.getElementById("result").innerHTML = html;
}
</script>
</body>
</html>

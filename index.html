<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Dose Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 800px;
  margin: auto;
}
input, button {
  padding: 8px;
  width: 100%;
  margin-top: 6px;
}
.section {
  border: 1px solid #ccc;
  padding: 12px;
  margin-top: 15px;
}
.ok { color: green; font-weight: bold; }
.warn { color: orange; font-weight: bold; }
.fail { color: red; font-weight: bold; }
</style>
</head>

<body>

<h2>TB Dose Calculator</h2>

<label>อายุ (ปี)</label>
<input type="number" id="age">

<label>น้ำหนัก (กก.)</label>
<input type="number" id="weight">

<button onclick="calculate()">คำนวณ</button>

<div id="result"></div>

<script>
function countTablet(dose, strength) {
  var n = dose / strength;
  if (Math.floor(n) === n || n % 0.5 === 0) {
    return n;
  }
  return null;
}

function calculate() {

  var age = Number(document.getElementById("age").value);
  var w = Number(document.getElementById("weight").value);
  var r = document.getElementById("result");

  if (!w || w <= 0) {
    alert("กรุณากรอกน้ำหนัก");
    return;
  }

  var html = "";

  /* ================= 1. แยกเม็ด IRZE ================= */
  html += '<div class="section"><h3>1) แยกเม็ด (I R Z E)</h3>';

  // Isoniazid
  var Imin = w * 4;
  var Imax = Math.min(w * 6, 300);
  var Itab = countTablet(Imax, 300);
  html += '<b>Isoniazid (H)</b> 4–6 mg/kg/day<br>';
  html += Imin.toFixed(0) + ' – ' + Imax.toFixed(0) + ' mg/day<br>';
  html += (Itab ? Itab + ' เม็ด (300 mg)' : '<span class="fail">ไม่สามารถคำนวณเม็ดได้</span>');
  html += '<br><br>';

  // Rifampicin
  var Rmin = w * 8;
  var Rmax = Math.min(w * 12, 600);
  var R300 = countTablet(Rmax, 300);
  var R450 = countTablet(Rmax, 450);
  html += '<b>Rifampicin (R)</b> 8–12 mg/kg/day<br>';
  html += Rmin.toFixed(0) + ' – ' + Rmax.toFixed(0) + ' mg/day<br>';
  if (R300) html += '• ' + R300 + ' เม็ด (300 mg)<br>';
  if (R450) html += '• ' + R450 + ' เม็ด (450 mg)<br>';
  if (!R300 && !R450) html += '<span class="fail">ไม่สามารถคำนวณเม็ดได้</span><br>';
  html += '<br>';

  // Pyrazinamide
  var Zmin = w * 20;
  var Zmax = Math.min(w * 30, 2000);
  var Ztab = countTablet(Zmax, 500);
  html += '<b>Pyrazinamide (Z)</b> 20–30 mg/kg/day<br>';
  html += Zmin.toFixed(0) + ' – ' + Zmax.toFixed(0) + ' mg/day<br>';
  html += (Ztab ? Ztab + ' เม็ด (500 mg)' : '<span class="fail">ไม่สามารถคำนวณเม็ดได้</span>');
  html += '<br><br>';

  // Ethambutol
  var Emin = w * 15;
  var Emax = Math.min(w * 20, 1200);
  var E400 = countTablet(Emax, 400);
  var E500 = countTablet(Emax, 500);
  html += '<b>Ethambutol (E)</b> 15–20 mg/kg/day<br>';
  html += Emin.toFixed(0) + ' – ' + Emax.toFixed(0) + ' mg/day<br>';
  if (E500) html += '• ' + E500 + ' เม็ด (500 mg)<br>';
  if (E400) html += '• ' + E400 + ' เม็ด (400 mg)<br>';
  if (!E400 && !E500) html += '<span class="fail">ไม่สามารถคำนวณเม็ดได้</span><br>';

  html += '</div>';

  /* ================= 2. 2FDC ================= */
  html += '<div class="section"><h3>2) 2FDC</h3>';
  html += 'H 75 mg + R 150 mg / เม็ด<br>';
  var t2H = countTablet(Imax, 75);
  var t2R = countTablet(Rmax, 150);
  html += (t2H && t2H === t2R)
    ? '<span class="ok">ใช้ ' + t2H + ' เม็ด</span>'
    : '<span class="fail">ไม่สามารถคำนวณจำนวนเม็ดที่ลงตัวได้</span>';
  html += '</div>';

  /* ================= 3. 4FDC ================= */
  html += '<div class="section"><h3>3) 4FDC</h3>';
  html += 'H75 + R150 + Z400 + E275 mg / เม็ด<br>';
  var t4H = countTablet(Imax, 75);
  var t4R = countTablet(Rmax, 150);
  var t4Z = countTablet(Zmax, 400);
  var t4E = countTablet(Emax, 275);
  if (t4H && t4H === t4R && t4H === t4Z && t4H === t4E)
    html += '<span class="ok">ใช้ ' + t4H + ' เม็ด</span>';
  else
    html += '<span class="fail">ไม่สามารถคำนวณจำนวนเม็ดที่ลงตัวได้</span>';
  html += '</div>';

  /* ================= 4. 3HP ================= */
  html += '<div class="section"><h3>4) วัณโรคแฝง (3HP)</h3>';
  html += '1 เม็ด = INH 300 mg + Rifapentine 300 mg<br>';

  var inh, rpt;
  if (age <= 14) {
    if (w <= 15) { inh = 300; rpt = 300; }
    else if (w <= 23) { inh = 500; rpt = 450; }
    else if (w <= 30) { inh = 600; rpt = 600; }
    else { inh = 700; rpt = 750; }
  } else {
    inh = Math.min(Math.ceil((w * 15) / 100) * 100, 900);
    rpt = (w <= 50) ? 750 : 900;
  }

  var ti = countTablet(inh, 300);
  var tr = countTablet(rpt, 300);

  if (ti && tr) {
    html += 'INH ' + inh + ' mg → ' + ti + ' เม็ด<br>';
    html += 'Rifapentine ' + rpt + ' mg → ' + tr + ' เม็ด<br>';
    if (ti * 300 > inh || tr * 300 > rpt)
      html += '<span class="warn">⚠ โปรดใช้ดุลยพินิจในการตัดสินใจ</span>';
  } else {
    html += '<span class="fail">ไม่สามารถคำนวณจำนวนเม็ดได้</span>';
  }

  html += '</div>';

  html += '<p><i>หมายเหตุ: การคำนวณอาจผิดพลาดได้ กรุณาตรวจสอบข้อมูลก่อนนำไปใช้</i></p>';

  r.innerHTML = html;
}
</script>

</body>
</html>

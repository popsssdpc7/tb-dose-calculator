<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Dose Calculator</title>
<style>
body { font-family: Arial, sans-serif; margin: 30px; }
.box { border: 1px solid #ccc; padding: 15px; margin-top: 20px; }
.warn { color: red; font-weight: bold; }
.footer { margin-top: 40px; border-top: 2px solid #ccc; padding-top: 10px; color: #b00000; }
</style>
</head>

<body>

<h1>โปรแกรมคำนวณขนาดยาวัณโรค</h1>

อายุ (ปี):
<input type="number" id="age">
น้ำหนัก (kg):
<input type="number" id="weight">
<button onclick="calculate()">คำนวณ</button>

<div id="output"></div>

<div class="footer">
⚠ โปรแกรมอาจคำนวณผิดพลาดได้ โปรดตรวจสอบก่อนนำข้อมูลไปใช้<br>
ไม่ทดแทนดุลยพินิจแพทย์
</div>

<script>
function recommendTablet(minMg, maxMg, tabMg) {
  let full = null;
  let half = null;

  for (let t = 1; t <= 10; t++) {
    const dose = t * tabMg;
    if (dose >= minMg && dose <= maxMg) {
      full = t;
      break;
    }
  }

  if (!full) {
    for (let t = 0.5; t <= 10; t += 0.5) {
      const dose = t * tabMg;
      if (dose >= minMg && dose <= maxMg) {
        half = t;
        break;
      }
    }
  }

  if (full) return `${full} เม็ด`;
  if (half) return `${half} เม็ด`;
  return "ไม่สามารถคำนวณจำนวนเม็ดที่เหมาะสมได้";
}

function calculate() {
  const age = +document.getElementById("age").value;
  const wt = +document.getElementById("weight").value;
  if (!age || !wt) return alert("กรุณากรอกอายุและน้ำหนัก");

  let o = "";

  /* I */
  const Imin = wt * 4, Imax = wt * 6;
  const Irec = recommendTablet(Imin, Imax, 300);

  /* R */
  const Rmin = wt * 8, Rmax = wt * 12;
  const Rrec = recommendTablet(Rmin, Rmax, 300);

  /* Z */
  const Zmin = wt * 20, Zmax = Math.min(wt * 30, 2000);
  const Zrec = recommendTablet(Zmin, Zmax, 500);

  /* E */
  const Emin = wt * 15, Emax = Math.min(wt * 20, 1200);
  const Erec = recommendTablet(Emin, Emax, 500);

  o += `
  <div class="box">
  <h2>1) แยกเม็ดยา I / R / Z / E</h2>
  <b>Isoniazid (4–6 mg/kg)</b><br>${Imin}-${Imax} mg → ${Irec}<br><br>
  <b>Rifampicin (8–12 mg/kg)</b><br>${Rmin}-${Rmax} mg → ${Rrec}<br><br>
  <b>Pyrazinamide (20–30 mg/kg)</b><br>${Zmin}-${Zmax} mg → ${Zrec}<br><br>
  <b>Ethambutol (15–20 mg/kg)</b><br>${Emin}-${Emax} mg → ${Erec}
  </div>
  `;

  /* 2FDC */
  const R2min = Rmin, R2max = Rmax;
  const FDC2 = recommendTablet(R2min, R2max, 150);

  o += `
  <div class="box">
  <h2>2) 2FDC (H75 + R150)</h2>
  แนะนำ: ${FDC2}
  </div>
  `;

  /* 4FDC */
  const Z4min = Zmin, Z4max = Zmax;
  const FDC4 = recommendTablet(Z4min, Z4max, 400);

  o += `
  <div class="box">
  <h2>3) 4FDC</h2>
  แนะนำ: ${FDC4}
  </div>
  `;

  /* 3HP */
  let inh = 0, rpt = 0;
  if (age <= 14) {
    if (wt <= 15) { inh = 300; rpt = 300; }
    else if (wt <= 23) { inh = 500; rpt = 450; }
    else if (wt <= 30) { inh = 600; rpt = 600; }
    else { inh = 700; rpt = 750; }
  } else {
    inh = Math.min(Math.ceil((wt * 15) / 100) * 100, 900);
    rpt = wt <= 50 ? 750 : 900;
  }

  const HP = recommendTablet(Math.max(inh, rpt), Math.max(inh, rpt), 300);

  o += `
  <div class="box">
  <h2>4) วัณโรคแฝง (3HP)</h2>
  INH ${inh} mg + Rifapentine ${rpt} mg<br>
  แนะนำ: ${HP} / สัปดาห์
  </div>
  `;

  document.getElementById("output").innerHTML = o;
}
</script>

</body>
</html>

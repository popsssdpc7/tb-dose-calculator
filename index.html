<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>คำนวณขนาดยาวัณโรค</title>
<style>
body { font-family: sans-serif; margin: 20px; }
button { margin: 5px; padding: 8px 12px; }
.result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
.small { color: #666; font-size: 0.9em; margin-top: 15px; }
</style>
</head>

<body>

<h2>โปรแกรมคำนวณขนาดยาวัณโรค</h2>

<button onclick="showTB()">คำนวณขนาดยาวัณโรค</button>
<button onclick="showLTBI()">คำนวณขนาดยาวัณโรคแฝง (3HP)</button>

<div id="inputArea"></div>
<div id="result" class="result"></div>

<script>
function showTB() {
  document.getElementById("inputArea").innerHTML = `
    <h3>วัณโรคปกติ</h3>
    น้ำหนัก (kg): <input id="weight" type="number">
    <button onclick="calcTB()">คำนวณ</button>
  `;
  document.getElementById("result").innerHTML = "";
}

function showLTBI() {
  document.getElementById("inputArea").innerHTML = `
    <h3>วัณโรคแฝง (3HP)</h3>
    อายุ (ปี): <input id="age" type="number"><br><br>
    น้ำหนัก (kg): <input id="weight" type="number">
    <button onclick="calc3HP()">คำนวณ</button>
  `;
  document.getElementById("result").innerHTML = "";
}

function rangeText(min, max) {
  return `${min} – ${max} mg`;
}

function preferFullTablet(mg, strength) {
  return Math.round(mg / strength);
}

/* ---------- TB ปกติ ---------- */
function calcTB() {
  const w = Number(document.getElementById("weight").value);
  if (!w) return;

  let I_min = 4 * w, I_max = 6 * w;
  let R_min = 8 * w, R_max = 12 * w;
  let Z_min = 20 * w, Z_max = 30 * w;
  let E_min = 15 * w, E_max = 20 * w;

  let html = `<h3>ผลการคำนวณ (วัณโรคปกติ)</h3>`;

  html += `
<b>Isoniazid (I)</b><br>
ขนาดยาที่คำนวณได้: ${rangeText(I_min, I_max)}/day<br>
แนะนำรับประทาน: ${preferFullTablet(I_min,100)}–${preferFullTablet(I_max,100)} เม็ด (100 mg/เม็ด)<br><br>

<b>Rifampin (R)</b><br>
ขนาดยาที่คำนวณได้: ${rangeText(R_min, R_max)}/day<br>
• เม็ด 300 mg: ${preferFullTablet(R_min,300)}–${preferFullTablet(R_max,300)} เม็ด<br>
• เม็ด 450 mg: ${preferFullTablet(R_min,450)}–${preferFullTablet(R_max,450)} เม็ด<br><br>

<b>Pyrazinamide (Z)</b><br>
ขนาดยาที่คำนวณได้: ${rangeText(Z_min, Z_max)}/day<br>
แนะนำรับประทาน: ${preferFullTablet(Z_min,500)}–${preferFullTablet(Z_max,500)} เม็ด (500 mg/เม็ด)<br><br>

<b>Ethambutol (E)</b><br>
ขนาดยาที่คำนวณได้: ${rangeText(E_min, E_max)}/day<br>
• เม็ด 400 mg: ${preferFullTablet(E_min,400)}–${preferFullTablet(E_max,400)} เม็ด<br>
• เม็ด 500 mg: ${preferFullTablet(E_min,500)}–${preferFullTablet(E_max,500)} เม็ด<br>
`;

  html += `
<div class="small">
⚠️ โปรแกรมอาจคำนวณผิดพลาดได้ โปรดตรวจสอบก่อนนำข้อมูลไปใช้  
ไม่ทดแทนดุลยพินิจแพทย์
</div>
`;

  document.getElementById("result").innerHTML = html;
}

/* ---------- TB แฝง 3HP ---------- */
function calc3HP() {
  const w = Number(document.getElementById("weight").value);
  const age = Number(document.getElementById("age").value);
  if (!w || !age) return;

  let INH = 15 * w; if (INH > 900) INH = 900;
  let RPT = 10 * w; if (RPT > 900) RPT = 900;

  let html = `<h3>ผลการคำนวณ (วัณโรคแฝง : 3HP)</h3>`;

  html += `
<b>Isoniazid (INH)</b><br>
ขนาดยาที่คำนวณได้: ≤ ${INH} mg/ครั้ง<br>
แนะนำรับประทาน: ${preferFullTablet(INH,300)} เม็ด (300 mg/เม็ด)<br><br>

<b>Rifapentine (RPT)</b><br>
ขนาดยาที่คำนวณได้: ≤ ${RPT} mg/ครั้ง<br>
แนะนำรับประทาน: ${preferFullTablet(RPT,150)} เม็ด (150 mg/เม็ด)<br><br>

<b>วิธีรับประทาน</b><br>
รับประทาน <b>1 ครั้ง/สัปดาห์ เป็นเวลา 12 สัปดาห์</b>
`;

  html += `
<div class="small">
⚠️ โปรแกรมอาจคำนวณผิดพลาดได้ โปรดตรวจสอบก่อนนำข้อมูลไปใช้  
ไม่ทดแทนดุลยพินิจแพทย์
</div>
`;

  document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>

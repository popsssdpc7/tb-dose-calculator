<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Drug Dose Calculator</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    padding: 30px;
}
.container {
    max-width: 680px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
h2 { text-align: center; }
label { font-weight: bold; }
input {
    width: 100%;
    padding: 8px;
    margin: 10px 0 20px;
    font-size: 16px;
}
button {
    width: 100%;
    padding: 12px;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
}
button:hover { background: #125aa0; }
.result {
    margin-top: 25px;
    padding: 15px;
    border-radius: 8px;
    background: #eef3f8;
}
.drug {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px dashed #bbb;
}
.alert { color: red; font-weight: bold; }
.option { margin-left: 10px; }
small { color: #555; }
</style>
</head>

<body>

<div class="container">
<h2>คำนวณขนาดยาวัณโรค</h2>

<label>น้ำหนักตัว (kg)</label>
<input type="number" id="weight" placeholder="เช่น 60" min="1">

<button onclick="calculateDose()">คำนวณขนาดยา</button>

<div id="result" class="result" style="display:none;"></div>
</div>

<script>
// คำนวณช่วงขนาดยา
function calculateDrug(weight, minMgKg, maxMgKg, maxDose) {
    const minDose = weight * minMgKg;
    const maxDoseCalc = weight * maxMgKg;
    const finalMax = Math.min(maxDoseCalc, maxDose);

    return {
        min: Math.round(minDose),
        max: Math.round(finalMax),
        exceeded: maxDoseCalc > maxDose
    };
}

// หา tablet option ที่อยู่ในช่วง dose
function tabletOptions(minDose, maxDose, strengths, absoluteMax) {
    let results = [];

    strengths.forEach(strength => {
        for (let tabs = 1; tabs <= 10; tabs++) {
            let dose = tabs * strength;

            if (dose < minDose) continue;
            if (dose > maxDose) continue;
            if (dose > absoluteMax) continue;

            results.push({
                tabs,
                strength,
                dose
            });
        }
    });

    // เรียงจาก dose ต่ำ → สูง
    return results.sort((a, b) => a.dose - b.dose);
}

function calculateDose() {
    const weight = document.getElementById("weight").value;
    if (!weight || weight <= 0) {
        alert("กรุณาระบุน้ำหนักให้ถูกต้อง");
        return;
    }

    const H = calculateDrug(weight, 4, 6, 300);
    const R = calculateDrug(weight, 8, 12, 600);
    const Z = calculateDrug(weight, 20, 30, 2000);
    const E = calculateDrug(weight, 15, 20, 1200);

    const H_opt = tabletOptions(H.min, H.max, [100], 300);
    const R_opt = tabletOptions(R.min, R.max, [300, 450], 600);
    const Z_opt = tabletOptions(Z.min, Z.max, [500], 2000);
    const E_opt = tabletOptions(E.min, E.max, [500, 400], 1200);

    const renderOptions = opts =>
        opts.map(o =>
            `• ${o.tabs} เม็ด (${o.strength} mg/tab = ${o.dose} mg)`
        ).join("<br>");

    const result = document.getElementById("result");
    result.style.display = "block";

    result.innerHTML = `
    <div class="drug">
        <b>Isoniazid (H)</b><br>
        ${H.min} – ${H.max} mg/day<br>
        ${renderOptions(H_opt)}
        ${H.exceeded ? '<br><span class="alert">⚠ max dose 300 mg</span>' : ''}
    </div>

    <div class="drug">
        <b>Rifampicin (R)</b><br>
        ${R.min} – ${R.max} mg/day<br>
        ${renderOptions(R_opt)}
        ${R.exceeded ? '<br><span class="alert">⚠ max dose 600 mg</span>' : ''}
    </div>

    <div class="drug">
        <b>Pyrazinamide (Z)</b><br>
        ${Z.min} – ${Z.max} mg/day<br>
        ${renderOptions(Z_opt)}
        ${Z.exceeded ? '<br><span class="alert">⚠ max dose 2000 mg</span>' : ''}
    </div>

    <div class="drug">
        <b>Ethambutol (E)</b><br>
        ${E.min} – ${E.max} mg/day<br>
        ${renderOptions(E_opt)}
        ${E.exceeded ? '<br><span class="alert">⚠ max dose 1200 mg</span>' : ''}
    </div>

    <small>
    ⚠️ เครื่องมือนี้ใช้เพื่อช่วยคำนวณขนาดยาเท่านั้น  
    ไม่ทดแทนดุลยพินิจแพทย์
    </small>
    `;
}
</script>

</body>
</html>


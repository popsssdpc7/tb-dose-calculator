<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>TB Drug Dose Calculator</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    padding: 30px;
}
.container {
    max-width: 720px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
h2 { text-align: center; }
label { font-weight: bold; }
input {
    width: 100%;
    padding: 8px;
    margin: 10px 0 20px;
    font-size: 16px;
}
button {
    width: 100%;
    padding: 12px;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
}
button:hover { background: #125aa0; }
.result {
    margin-top: 25px;
    padding: 15px;
    border-radius: 8px;
    background: #eef3f8;
}
.drug {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px dashed #bbb;
}
.alert { color: red; font-weight: bold; }
small { color: #555; }
</style>
</head>

<body>

<div class="container">
<h2>คำนวณขนาดยาวัณโรค</h2>

<label>น้ำหนักตัว (kg)</label>
<input type="number" id="weight" placeholder="เช่น 60" min="1">

<button onclick="calculateDose()">คำนวณขนาดยา</button>

<div id="result" class="result" style="display:none;"></div>
</div>

<script>
// ===== Drug dose calculation =====
function calculateDrug(weight, minMgKg, maxMgKg, maxDose) {
    const minDose = weight * minMgKg;
    const maxDoseCalc = weight * maxMgKg;
    return {
        min: Math.round(minDose),
        max: Math.round(Math.min(maxDoseCalc, maxDose)),
        maxDose: maxDose
    };
}

// ===== FDC calculation =====
function calculateFDCOptions(weight, fdc, components) {
    let options = [];

    for (let tabs = 1; tabs <= 10; tabs++) {
        let valid = true;

        for (let c of components) {
            let dose = tabs * c.strength;
            let min = weight * c.minMgKg;
            let max = Math.min(weight * c.maxMgKg, c.maxDose);

            if (dose < min || dose > max) {
                valid = false;
                break;
            }
        }

        if (valid) {
            options.push(tabs);
        }
    }
    return options;
}

function calculateDose() {
    const weight = document.getElementById("weight").value;
    if (!weight || weight <= 0) {
        alert("กรุณาระบุน้ำหนักให้ถูกต้อง");
        return;
    }

    // ===== Single drugs =====
    const H = calculateDrug(weight, 4, 6, 300);
    const R = calculateDrug(weight, 8, 12, 600);
    const Z = calculateDrug(weight, 20, 30, 2000);
    const E = calculateDrug(weight, 15, 20, 1200);

    // ===== FDC definitions =====
    const FDC2 = calculateFDCOptions(weight, "2FDC", [
        { name: "H", strength: 75,  minMgKg: 4,  maxMgKg: 6,  maxDose: 300 },
        { name: "R", strength: 150, minMgKg: 8,  maxMgKg: 12, maxDose: 600 }
    ]);

    const FDC4 = calculateFDCOptions(weight, "4FDC", [
        { name: "H", strength: 75,  minMgKg: 4,  maxMgKg: 6,  maxDose: 300 },
        { name: "R", strength: 150, minMgKg: 8,  maxMgKg: 12, maxDose: 600 },
        { name: "Z", strength: 400, minMgKg: 20, maxMgKg: 30, maxDose: 2000 },
        { name: "E", strength: 275, minMgKg: 15, maxMgKg: 20, maxDose: 1200 }
    ]);

    const result = document.getElementById("result");
    result.style.display = "block";

    result.innerHTML = `
    <div class="drug">
        <b>Isoniazid (H)</b>: ${H.min} – ${H.max} mg/day
    </div>

    <div class="drug">
        <b>Rifampicin (R)</b>: ${R.min} – ${R.max} mg/day
    </div>

    <div class="drug">
        <b>Pyrazinamide (Z)</b>: ${Z.min} – ${Z.max} mg/day
    </div>

    <div class="drug">
        <b>Ethambutol (E)</b>: ${E.min} – ${E.max} mg/day
    </div>

    <div class="drug">
        <b>2FDC</b> (H 75 mg + R 150 mg)<br>
        ${FDC2.length ? 
            `ขนาดยาที่ใช้ได้: ${FDC2.map(t => `${t} เม็ด`).join(", ")}` 
            : '<span class="alert">⚠ ไม่พบขนาดที่อยู่ในช่วง dose</span>'}
    </div>

    <div class="drug">
        <b>4FDC</b> (H 75 mg + R 150 mg + Z 400 mg + E 275 mg)<br>
        ${FDC4.length ? 
            `ขนาดยาที่ใช้ได้: ${FDC4.map(t => `${t} เม็ด`).join(", ")}` 
            : '<span class="alert">⚠ ไม่พบขนาดที่อยู่ในช่วง dose</span>'}
    </div>

    <small>
    ⚠️ เครื่องมือนี้ใช้เพื่อช่วยคำนวณขนาดยาเท่านั้น  
    ไม่ทดแทนดุลยพินิจแพทย์
    </small>
    `;
}
</script>

</body>
</html>
